Option Explicit

Function ExistePagina(nombrePag As String, Optional wb As Workbook) As Boolean
    Dim test As Worksheet
    If wb Is Nothing Then
        Set wb = ThisWorkbook 'Usar el libro actual, si no se ha especificado otro
    End If
    On Error GoTo ErrorHandler
    Set test = wb.Sheets(nombrePag)
    ExistePagina = True
    Exit Function
ErrorHandler:
    'Ha ocurrido un error al abrir la pagina, no existe
    ExistePagina = False
End Function

Sub Reestablecer()
    Call contra

    Dim Datos As Worksheet
    Dim Distancias As Worksheet
    Dim Apoyo As Worksheet
    Dim Tabla As Worksheet
    Dim numApoyo As String
    Dim n As Long
    Dim OutPut As Integer

    Set Datos = ThisWorkbook.Sheets("Datos")
    Set Distancias = ThisWorkbook.Sheets("Distancias")
    Set Tabla = ThisWorkbook.Sheets("Tabla")
    n = 2
    'Resetear botones
    Call MsgBoxCustom_Reset(0)
    Call Columnas
    OutPut = MsgBox("Se reestablecera el excel borrando todos los datos, continuar?", vbYesNo + vbExclamation)
    If OutPut = 6 Then
        'Desactivar actulaizaciones de pantalla
        Application.ScreenUpdating = False
        'Desactivar calculacion automatica hasta despues de pegar todos los valores
        Application.Calculation = xlCalculationManual
        Application.DisplayAlerts = False
        'Limpiar hojas de apoyos
        Do While Datos.Cells(n, 1) <> ""
            numApoyo = Datos.Cells(n, 2).Text
            'Si no es un espacio en blanco, borrar
            If Datos.Cells(n, 2).Text <> "" And ExistePagina(numApoyo) Then
                Set Apoyo = ThisWorkbook.Sheets(numApoyo)
                Apoyo.Select
                ActiveWindow.SelectedSheets.Delete
                'Quitar vinculos de titulos
                Datos.Select
                Datos.Cells(n, 2).Select
                Selection.Hyperlinks(1).Delete
                With Selection
                    .HorizontalAlignment = xlCenter
                    .VerticalAlignment = xlCenter
                    .WrapText = False
                    .Orientation = 0
                    .AddIndent = False
                    .IndentLevel = 0
                    .ShrinkToFit = False
                    .ReadingOrder = xlContext
                    With .Font
                        .Name = "Calibri"
                        .Size = 12
                    End With
                    With .Borders
                        .LineStyle = xlContinuous
                        .ColorIndex = 0
                        .TintAndShade = 0
                        .Weight = xlThin
                    End With
                End With
                Datos.Cells(n, colCr) = ""
            End If
            n = n + 1
        Loop
        Application.DisplayAlerts = True
        'Limpiar Datos
        Datos.Range("A2:C1048576").ClearContents
        Datos.Range("E2:V1048576").ClearContents
        Datos.Range("U2:U178").Value = "FALSO"
        Datos.Columns("V:V").MergeCells = False
        Datos.Range("Y1:Y3").Value = ""
        'Borrar Tabla
        Call BorrarTabla
        'Borrar Distancias
        Distancias.Select
        Range("A3:J1048576").Select
        Selection.ClearContents
        'Seleccionar Datos y acabar
        Datos.Select
    Else
        'Se ha decidido no continuar con la operación
        Exit Sub
    End If
    Datos.Select
    'Activar actualización de pantalla
    Application.ScreenUpdating = True
    'Activar calculacion automatica
    Application.Calculation = xlCalculationAutomatic
End Sub